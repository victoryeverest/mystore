{% extends 'core/base2.html' %}
{% load crispy_forms_tags %}

{% block body %}
  <!-- Content -->
        <div class="container container-content">
            <ul class="breadcrumb v2">
                <li><a href="#">Home</a></li>
                <li><a href="#">Category</a></li>
                <li class="active">Single Product</li>
            </ul>
        </div>
        <div class="container container-content">
            <div class="single-product-detail v3">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-md-6 zoa-width1">
                        <div class="product-img-slide">
                            <div class="product-images">
                                <div class="ribbon zoa-sale"><span>-15%</span></div>
                                                        {% for image in product.product_images.all %}
                                <div class="main-img js-product-slider-normal">
                                    <a href="#" class="hover-images effect"><img src="{{ image.image.url }}" alt="photo" class="img-responsive"></a>
                                     </div>
                                {% endfor %}
                            </div>
                            <div class="multiple-img-list js-click-product-normal">
                                <div class="product-col">
                                  <div class="img active">
                                        <img src="img/product/single_1.jpg" alt="photo" class="img-responsive">
                                    </div>
                                </div>
                                <div class="product-col">
                                    <div class="img">
                                        <img src="img/product/single_2.jpg" alt="images" class="img-responsive">
                                    </div>
                                </div>
                                <div class="product-col">
                                    <div class="img">
                                        <img src="img/product/single_3.jpg" alt="images" class="img-responsive">
                                    </div>
                                </div>
                                <div class="product-col">
                                    <div class="img">
                                        <img src="img/product/single_4.jpg" alt="images" class="img-responsive">
                                    </div>
                                </div>
                                <div class="product-col">
                                    <div class="img">
                                        <img src="img/product/single_5.jpg" alt="images" class="img-responsive">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-6 zoa-width2">
                        <div class="single-product-info product-info product-grid-v2">
                            <h3 class="product-title"><a href="#">T-shirt Smooth</a></h3>
                            <div class="product-price">
                                <span class="old thin">$59.00</span>
                                <span>$29.00</span>
                            </div>
                            <div class="flex product-rating">
                                <div class="group-star">
                                    <span class="star star-5"></span>
                                    <span class="star star-4"></span>
                                    <span class="star star-3"></span>
                                    <span class="star star-2"></span>
                                    <span class="star star-1"></span>
                                </div>
                                <div class="number-rating">( 02 reviews )</div>
                            </div>
                            <div class="product-countdown text-center">
                                <h3>HURRY! ONLY <span>36</span> LEFT IN STOCK.</h3>
                                <div class="progress">
                                    <span class="progress-bar progress-bar-striped active" style="width:64.4444%"></span>
                                </div>
                                <div class="countdown countdown-time" data-countdown="countdown" data-date="08-31-2018-00-00-00">
                                </div>
                            </div>
                            <div class="color-group">
                                <label>Color :</label>
                                <a href="#" class="circle gray"></a>
                                <a href="#" class="circle active yellow"></a>
                                <a href="#" class="circle white"></a>
                            </div>
                            <div class="product-size">
                                <div class="size-group">
                                    <label>Size :</label>
                                    <select class="single-option-selector" data-option="option1" id="productSelect-option-0">
                                        <option value="S">S</option>
                                        <option value="L">L</option>
                                        <option value="XL">XL</option>
                                    </select>
                                </div>
                                <a href="" class="size-guide">Size guide</a>
                            </div>
                            <div class="single-product-button-group">
                                <div class="flex align-items-center element-button">
                                    <div class="zoa-qtt">
                                        <button type="button" class="quantity-left-minus btn btn-number js-minus" data-type="minus" data-field="">
                                        </button>
                                        <input type="text" name="number" value="1" class="product_quantity_number js-number">
                                        <button type="button" class="quantity-right-plus btn btn-number js-plus" data-type="plus" data-field="">
                                        </button>
                                    </div>
                                    <a href="" class="zoa-btn zoa-addcart">
                                            <i class="zoa-icon-cart"></i>add to cart
                                        </a>
                                </div>
                                <a href="" class="btn-wishlist">+ Add to wishlist</a>
                            </div>
                            
                            <div class="product-social">
                                <label>Share +</label>
                                <div class="social">
                                    <a href=""><i class="fa fa-facebook"></i></a>
                                    <a href=""><i class="fa fa-twitter"></i></a>
                                    <a href=""><i class="fa fa-instagram"></i></a>
                                    <a href=""><i class="fa fa-pinterest"></i></a>
                                </div>
                            </div>
                            <div class="single-product-tab bd-top">
                                <div class="zoa-tab-collapse-block panel-group">
                                    <div class="panel zoa-tab-item">
                                        <div class="panel-heading">
                                            <h3 class="panel-title zoa-tab-title"><a href="#panelBodyOne" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion">Description</a></h3>
                                        </div>
                                        <div id="panelBodyOne" class="zoa-collapse-content panel-collapse collapse in">
                                            <div class="panel-body">
                                                <p>
                                                    Round neck sweater with long sleeves. Features a knotted opening in the front. Phasellus gravida dolor in sem placerat sodales lullam feugiat non dolor id commodo. Phasellus nec velit enim. Donec a commodo magna. Cras aliquet, ante et varius lobor
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel zoa-tab-item">
                                        <div class="panel-heading">
                                            <h3 class="panel-title zoa-tab-title"><a href="#panelBodyTwo" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion">Shipping Detail</a></h3>
                                        </div>
                                        <div id="panelBodyTwo" class="zoa-collapse-content panel-collapse collapse">
                                            <div class="panel-body">
                                                <p>
                                                    Free shopping
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel zoa-tab-item">
                                        <div class="panel-heading">
                                            <h3 class="panel-title zoa-tab-title"><a href="#panelBodyThree" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion">Customer reviews (2)</a></h3>
                                        </div>
                                        <div id="panelBodyThree" class="zoa-collapse-content panel-collapse collapse">
                                            <div class="panel-body">
                                                <ul class="review-content">
                                                    <li class="element-review">
                                                        <div class="flex align-items-center justify-content-between">
                                                            <div class="review-left">
                                                                <p class="r-name">Felix Nguyen</p>
                                                                <p class="r-date">25, March 2018</p>
                                                            </div>
                                                            <div class="group-star">
                                                                <span class="star star-5"></span>
                                                                <span class="star star-4"></span>
                                                                <span class="star star-3"></span>
                                                                <span class="star star-2"></span>
                                                                <span class="star star-1"></span>
                                                            </div>
                                                        </div>
                                                        <p class="r-desc">
                                                            Free shipping on orders over 150€ within Europe and North America.
                                                        </p>
                                                    </li>
                                                    <li class="element-review">
                                                        <div class="flex align-items-center justify-content-between">
                                                            <div class="review-left">
                                                                <p class="r-name">Felix Nguyen</p>
                                                                <p class="r-date">25, March 2018</p>
                                                            </div>
                                                            <div class="group-star">
                                                                <span class="star star-5"></span>
                                                                <span class="star star-4"></span>
                                                                <span class="star star-3"></span>
                                                                <span class="star star-2"></span>
                                                                <span class="star star-1"></span>
                                                            </div>
                                                        </div>
                                                        <p class="r-desc">
                                                            Free shipping on orders over 150€ within Europe and North America. Place your order today and receive it within 48 hours. And now, free and easy returns within Europe.
                                                        </p>
                                                    </li>
                                                </ul>
                                                <div class="review-form">
                                                    <h3 class="review-heading">Your Rating</h3>
                                                    <div class="rating-star">
                                                        <span class="fa fa-star-o" aria-hidden="true"></span>
                                                        <span class="fa fa-star-o" aria-hidden="true"></span>
                                                        <span class="fa fa-star-o" aria-hidden="true"></span>
                                                        <span class="fa fa-star-o" aria-hidden="true"></span>
                                                        <span class="fa fa-star-o" aria-hidden="true"></span>
                                                    </div>
                                                    <div class="cmt-form">
                                                        <div class="row">
                                                            <div class=" col-xs-12 mg-bottom-30">
                                                                <input type="text" id="name" class="form-control" name="comment[name]" value="" placeholder="Name *">
                                                            </div>
                                                            <div class="col-xs-12 mg-bottom-30">
                                                                <input type="email" id="email" class="form-control" name="comment[email]" value="" placeholder="Phone Number">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-12 mg-bottom-30">
                                                                <textarea id="message" class="form-control" name="comment[body]" rows="9" placeholder="Your reviews"></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="form-group text-center">
                                                            <button type="submit" class="zoa-btn">
                                                                Submit
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<section class="section-content padding-y">
  <div class="container mt-3">
    <!-- ============================ COMPONENT Product Details ================================= -->
    <div class="card">
      <div class="row no-gutters">
        <aside class="col-md-6">
          <!-- Gallery-Wrap -->
          <article class="gallery-wrap">
            <div class="text-center mt-5 ml-3 mr-3 img-big-wrap">
              <div class="carousel-inner">
                {% for image in product.product_images.all %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <img
                    id="mainImage"
                    src="/media/{{ image.image }}"
                    alt="{{ product.product_name }}"
                  />
                </div>
                {% endfor %}
              </div>

              <!-- Thumnbs-Wrap -->
              <div class="form-row thumbs-wrap mt-5 d-flex justify-content-center">
                {% for image in product.product_images.all %}
                <p class="item-thumb mx-2">
                  <img
                    src="/media/{{image.image}}"
                    class="img-thumbnail"
                    onclick="updateMainImage(this.src)"
                  />
                </p>
                {% endfor %}
              </div>
              <!-- Thumnbs-Wrap End.// -->
            </div>
          </article>
          <!-- Gallery-Wrap End.// -->
        </aside>
        <main class="col-md-6 border-left">
          <article class="content-body">
            <h2 class="title">{{product.product_name}}</h2>
            <h6 class="text-muted">{{product.category}}</h6>

            <div class="rating-wrap my-3">
              <small class="label-rating text-muted">{{ product.get_rating }}</small>
              <ul class="rating-stars">
                <li style="width: {{ rating_percentage }}%" class="stars-active">
                  <i class="fa fa-star"></i> <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i> <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                </li>
                <li>
                  <i class="fa fa-star"></i> <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i> <i class="fa fa-star"></i>
                  <i class="fa fa-star"></i>
                </li>
              </ul>
              <small class="label-rating text-muted">{{ product.reviews.count }} reviews</small>
              <small class="label-rating text-success">
                <i class="fa fa-clipboard-check"></i> 154 orders
              </small>
            </div>
            <!-- rating-wrap.// -->

            <div class="mb-3">
              {% if updated_price %}
              <var class="price h4">₦{{ updated_price }}.00</var>
              {% else%}
              <var class="price h4">₦{{ product.price }}.00</var>
              {% endif %}
            </div>
            <!-- price-detail-wrap .// -->

            <p style="line-height: 2rem; margin-top: revert; text-align: justify">
              {{product.product_desription}}
            </p>
            <br />
            <dl class="row">
              <dt class="col-sm-3">Brand</dt>
              <dd class="col-sm-9">Nike</dd>

              <dt class="col-sm-3">Color</dt>
              <dd class="col-sm-9">
                {% for color in product.color_variant.all %} {{ color.color_name }} {% endfor %}
              </dd>

              <dt class="col-sm-3">Delivery</dt>
              <dd class="col-sm-9">All over the World!</dd>
            </dl>

            <hr />
            <div class="form-row">
              <div class="form-group mr-3">
                <label>Quantity</label>
                <div class="input-group mb-3 input-spinner">
                  <div class="input-group-prepend">
                    <button
                      class="btn btn-light"
                      type="button"
                      id="button-plus"
                    >
                      +
                    </button>
                  </div>
                  <input type="text" class="form-control" value="1" />
                  <div class="input-group-append">
                    <button
                      class="btn btn-light"
                      type="button"
                      id="button-minus"
                    >
                      -
                    </button>
                  </div>
                </div>
              </div>

              {% if sorted_size_variants %}
              <div class="form-group col-md">
                <label>Select size</label>
                <div class="mt-1">
                  {% for size in sorted_size_variants %}

                  <label class="custom-control custom-radio custom-control-inline">
                    <input type="radio" name="selected_size" value="{{ size.size_name }}" 
                    onchange="get_correct_price('{{ size.size_name }}'); updateCartUrl();" 
                    id="size-{{ size.size_name }}" 
                    {% if selected_size == size.size_name %} checked {% endif %} class="custom-control-input" />
                    <div class="custom-control-label">{{ size.size_name }}</div>
                  </label>

                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>

            <!-- Add to Wishlist Button -->
            <div class="form-group d-flex justify-content-start">
              <div class="d-sm-flex mr-2">
                <div class="mb-2 mb-sm-0 mr-0 mr-sm-3">
                  <form method="POST" action="{% url 'add_to_wishlist' product.uid %}?size={{ selected_size }}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-primary">
                      <i class="fas fa-heart"></i> Add to Wishlist
                    </button>
                  </form>
                </div>
                <a
                  href="{% url 'add_to_cart' product.uid %}?size={{ selected_size }}"
                  id="add-to-cart-btn"
                  class="btn btn-primary"
                >
                  <i class="fas fa-shopping-bag mr-1"></i>
                  <span>Add to cart</span>
                </a>
              </div>
            </div>
          </article>
        </main>
      </div>
    </div>

    <!-- Related Products Section -->
    <h3 class="title padding-y-sm">Related products</h3>
    {% if related_products%} 
      {% with related_products as list_products %} 
      {% endwith %}
    {% else %}
    <p>No related products found.</p>
    {% endif %}
    <!-- Related Products Section End -->

    <hr />

    <!-- Product Review Section -->
    <h3 class="title padding-bottom-sm">Reviews</h3>

    {% for review in product.reviews.all %}
    <div class="card mb-3">
      <div class="card-body" style="background-color: #59ee8d91">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p>
              <strong>Posted on: </strong>{{ review.date_added|date:"Y-m-d" }} by
              <strong>{{ review.user.get_full_name }}</strong><br />
              <strong>Rating: </strong>{{ review.stars }}/5<br />
              <strong>Comment: </strong>{{ review.content }}
            </p>
          </div>
          <div class="d-flex flex-wrap align-items-center gap-2">
            {% if request.user.is_authenticated %}
            <!-- Like Button -->
            <button
              class="btn like-btn d-flex align-items-center"
              onclick="toggleLike('{{ review.uid }}')"
            >
              <i class="fas fa-thumbs-up me-2"></i>
              <span id="like-count-{{ review.uid }}">{{ review.like_count }}</span>
            </button>

            <!-- Dislike Button -->
            <button
              class="btn dislike-btn d-flex align-items-center"
              onclick="toggleDislike('{{ review.uid }}')"
            >
              <i class="fas fa-thumbs-down me-2"></i>
              <span id="dislike-count-{{ review.uid }}">{{ review.dislike_count }}</span>
            </button>
            
            {% else %}
            <button class="btn like-btn d-flex align-items-center">
              <i class="fas fa-thumbs-up me-2"></i>
              <span id="like-count-{{ review.uid }}">{{ review.like_count }}</span>
            </button>

            <button class="btn dislike-btn d-flex align-items-center">
              <i class="fas fa-thumbs-down me-2"></i>
              <span id="dislike-count-{{ review.uid }}">{{ review.dislike_count }}</span>
            </button>
            {% endif %}

            <!-- Delete Button -->
            {% if review.user == request.user %}
            <button
              class="btn btn-link p-0 text-danger ms-auto"
              title="Delete Review"
              data-bs-toggle="modal"
              data-bs-target="#deleteReviewModal"
              onclick="setDeleteAction('{% url 'delete_review' product.slug review.uid %}')"
              type="button"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="padding-bottom-sm">No reviews yet...</p>
    {% endfor %}

    <div class="card mb-3">
      <div class="card-body">
        <div class="form-group">
          {% if request.user.is_authenticated %}
          <form method="POST" action="">
            {% csrf_token %} {{ review_form|crispy }}
            <button class="btn btn-success">Submit</button>
          </form>
          {% else %}
          <p>Please <a href="{% url 'login' %}"> sign in </a> to add review!</p>
          {% endif %}
        </div>
      </div>
    </div>
    <!-- Product Review Section End-->
    <!-- ============================ COMPONENT Product Details End ================================= -->
  </div>

  <!-- Delete Review Confirmation Modal -->
  <div
    class="modal fade"
    id="deleteReviewModal"
    tabindex="-1"
    aria-labelledby="deleteReviewModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteReviewModalLabel">
            Confirm Delete
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this review?
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <form id="deleteReviewForm" method="POST" style="display: inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}